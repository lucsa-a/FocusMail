<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="icon" type="image/png" href="static/assets/check_box.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="static/reset.css">
  <link rel="stylesheet" href="static/styles.css">
  <meta charset="UTF-8">
  <title>Resultados - FocusMail</title>
</head>
<body>
  <div id="boxPrincipal">
    <header>
      <a href="/">
        <img src="static/assets/check_box.svg" id="logoImg"/>
        <h1 id="logoTitulo">FocusMail</h1>
      </a>
    </header>
    <h2 id="tituloResultados">Resultados da Classificação</h2>

    <progress id="produtividade" value="{{ porcentagem_produtivos }}" max="100">
        {{ porcentagem_produtivos }}%
    </progress>
    
    <div id="porcentagens">
        <div class="porcentagem">
            <p>Produtivo</p>
            <strong>{{ porcentagem_produtivos }}%</strong>
        </div>
        <div class="porcentagem">
            <p>Improdutivo</p>
            <strong>{{ 100 - porcentagem_produtivos }}%</strong>
        </div>
    </div>

    <button id="botaoLimpar">Limpar Seleção</button>

    {% if resultados %}
        <ul>
        {% for r in resultados %}
        <li class="resultado-item 
          {% if r.get('categoria') %}
            {% if r.categoria.lower() == 'produtivo' %}produtivo
            {% elif r.categoria.lower() == 'improdutivo' %}improdutivo
            {% else %}erro{% endif %}
          {% else %}erro{% endif %}">
              {% if r.filename.endswith('.txt') or r.filename.endswith('.pdf') %}
              <div class="arquivo"><strong>Arquivo:</strong> <span class="nome-arquivo">{{ r.filename }}</span></div>
              {% endif %}
            
              {% if r.erro %}
                <div class="erro" role="alert"><span>Erro: {{ r.erro }}</span></div>
              {% else %}
                <strong>{{ r.categoria }}</strong>
                <pre class="texto">{{ r.texto_extraido }}</pre>
                <div class="resposta">
                  <strong>Resposta sugerida:</strong>
                  <pre class="resposta-texto">{{ r.resposta_sugerida }}</pre>
                </div>
            {% endif %}
          </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>Nenhum resultado encontrado.</p>
    {% endif %}
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btnProdutivo = document.querySelector("#porcentagens .porcentagem:first-child");
      const btnImprodutivo = document.querySelector("#porcentagens .porcentagem:last-child");
      const limparBtn = document.querySelector("#botaoLimpar");
      const lista = document.querySelectorAll(".resultado-item");
  
      limparBtn.textContent = "Selecione alguma porcentagem para filtrar e-mails";
  
      function mostrarTodos() {
        lista.forEach(li => li.style.display = "");
        limparBtn.textContent = "Selecione alguma porcentagem para filtrar e-mails";
      }
  
      btnProdutivo.addEventListener("click", () => {
        lista.forEach(li => {
          if (li.classList.contains("produtivo")) {
            li.style.display = "";
          } else {
            li.style.display = "none";
          }
        });
        limparBtn.textContent = "Limpar Seleção";
      });
  
      btnImprodutivo.addEventListener("click", () => {
        lista.forEach(li => {
          if (li.classList.contains("improdutivo")) {
            li.style.display = "";
          } else {
            li.style.display = "none";
          }
        });
        limparBtn.textContent = "Limpar Seleção";
      });
  
      limparBtn.addEventListener("click", mostrarTodos);
    });
  </script>  
</body>
</html>
